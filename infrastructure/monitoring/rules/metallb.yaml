apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: metallb-rules
spec:
  groups:
    - name: LoadBalancer
      rules:
        - alert: MetalLBNoLeader
          expr: count(metallb_k8s_client_leadership_bool == 1) == 0
          for: 2m
          annotations:
            description: MetalLB has had no leader for the past 2 minutes.
            summary: MetalLB has no leader
        - alert: MetalLBConfigStale
          expr: metallb_k8s_client_config_stale_bool != 0
          for: 2m
          annotations:
            description: '{{ $labels.instance }}: MetalLB instance has stale configuration.'
            summary: '{{ $labels.instance }}: MetalLB stale configuration.'
        - alert: MetalLBNoUsableAddresses
          expr: metallb_allocator_addresses_total == 0
          annotations:
            description: 'MetalLB has no usable addresses.'
            summary: 'MetalLB no usable address space.'
