apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: cloudlab-db
  namespace: default
spec:
  teamId: cloudlab
  numberOfInstances: 1
  preparedDatabases:
    wesley:
      secretNamespace: wesley
      defaultUsers: true
      extensions:
        uuid-ossp: public
      schemas:
        public:
          defaultRoles: false

  postgresql:
    version: "14"
    parameters:
      password_encryption: scram-sha-256
  volume:
    size: 10Gi
    storageClass: hcloud-volumes
  resources:
    requests:
      cpu: 100m
      memory: 100Mi
    limits:
      cpu: 500m
      memory: 500Mi
  patroni:
    pg_hba:
      - local     all           all                       trust
      - host      all           all         127.0.0.1/32  md5
      - host      all           all         ::1/128       md5
      - local     replication   standby                   trust
      - hostssl   replication   standby     all           md5
      - hostnossl all           all         all           md5
      - hostssl   all           +zalandos   all           pam
      - hostssl   all           all         10.0.0.0/8    md5
      - hostssl   all           all         all           md5
